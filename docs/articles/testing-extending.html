<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Extending the Testing Framework </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Extending the Testing Framework ">
    <meta name="generator" content="docfx 2.58.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="extending-the-testing-framework">Extending the Testing Framework</h1>

<p><a href="https://www.nuget.org/packages/Philosoft.Testing"><code>Defender.Testing</code></a> was designed from the ground up to be extensible. In fact, the majority of its own design is through the extensibility mechanism. So how does one do so?</p>
<p>Extension methods. That's it. There's no clever things you need to learn like with <a href="https://nunit.org/">NUnit</a>, or mechanism that requires different syntax like <a href="https://docs.microsoft.com/en-us/dotnet/core/testing/unit-testing-with-mstest">MSTest</a>, or no possibility at all like with <a href="https://xunit.net/">xUnit</a>. This should be as easy, obvious, and straightforward as possible.</p>
<p>There's two points of extension that we'll cover. Some example extensions follow after.</p>
<h2 id="assertions">Assertions</h2>
<p>These are the methods called off of the <strong>Asserter</strong> object. They should always return the caller, so that assertions can optionally be chained. You write these like any assertion method, if you've ever written them for other frameworks. Check if a failure happened, and throw an exception if one did.</p>
<p>I can't reasonably provide a universal formatter for any possible situation, so by convention, format the exception message like so: <code>{Why the exception occurred}\nActual: {actual}\nExpected: {expected}</code>. But not everything needs the actual and expected values printed. And some things may need even more information printed. Use your head, but keep with the idea for the line terminators. Not everyone prefers using the test explorer as a central panel, with some opting to dock it on the side. Formatting the output like this allows for quick and easy reading regardless of the way the explorer is docked, or any other tooling presenting the issue.</p>
<p>The caller can be a little tricky but isn't too bad, because of how there's multiple <strong>Asserter</strong> types. The standard <strong>Asserter</strong> types are listed in that section below.</p>
<h2 id="asserter">Asserter</h2>
<p>This is what's generated by <code>Assert.That(actual)</code> calls. There isn't any single type, although <code>Asserter&lt;T&gt;</code> covers most use cases. You almost never need to extend this. The idea is for overloads of <code>That()</code> to handle creating the correct <strong>Asserter</strong> type. When extending this is necessary, typically do so by inheriting from one of the <strong>Asserter</strong> types, and override <code>Equals</code> as necessary.</p>
<h3 id="asserter-1">Asserter<t></t></h3>
<p>This is the most common <strong>Asserter</strong> and, in fact, works in the overwhelming majority of situations. It holds the instance, nothing more, nothing less.</p>
<h3 id="arrayasserter">ArrayAsserter</h3>
<p>Using <code>Asserter&lt;T&gt;</code> for <a href="https://docs.microsoft.com/en-us/dotnet/api/system.array"><code>Array</code></a> gets a little tricky. Instead of expecting people to figure all this out, it was easier to just provide a new asserter to handle that specifically.</p>
<h2 id="example-assertion">Example Assertion</h2>
<p>We'll use two examples from the standard assertions that are implemented as an extension. It's simple and easy to follow along with.</p>
<p>First, let's look at handling <code>Asserter&lt;T&gt;</code>:</p>
<pre><code class="lang-csharp">public static Asserter&lt;T&gt; Null&lt;T&gt;(this Asserter&lt;T&gt; assert) where T : class {
	if (assert.Actual is not null) {
		throw new AssertException($&quot;The instance was not null.\nActual: {assert.Actual}&quot;);
	}
	return assert;
}

public static Asserter&lt;Nullable&lt;T&gt;&gt; Null&lt;T&gt;(this Asserter&lt;Nullable&lt;T&gt;&gt; assert) where T : struct {
	if (assert.Actual is not null) {
		throw new AssertException($&quot;The instance was not null.\nActual: {assert.Actual}&quot;);
	}
	return assert;
}
</code></pre>
<p>Why two of otherwise the same assertion? Well, that's partially the power of this approach. In the first case, we're covering any reference type, which, of course that can potentially be <code>null</code>. The second covers any cases of <code>Nullable&lt;T&gt;</code> or <code>T?</code>. Together, these mean any non-nullable struct won't even have these checks presented, because the result is obvious. It also serves as an example of how <code>Asserter&lt;T&gt;</code> can be partially constrained, like with <code>Asserter&lt;Nullable&lt;T&gt;&gt;</code>.</p>
<p>Second, let's look at handling <code>ArrayAsserter</code>:</p>
<pre><code class="lang-csharp">public static ArrayAsserter Length(this ArrayAsserter assert, Int32 expected) {
	if (assert.Actual.Length != expected) {
		throw new AssertException($&quot;The length was not what was expected.\nActual: {assert.Actual.Length}\nExpected: {expected}&quot;);
	}
	return assert;
}
</code></pre>
<p>This will allow for <em>any</em> array to have its length checked in a clearer way than using <code>actual.Length</code> at the callsite, and works better with property testing.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Entomy/LibLangly/blob/master/Documentation/articles/testing-extending.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
